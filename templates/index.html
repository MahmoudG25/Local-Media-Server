<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8">
  <title>Local Media Server</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Bootstrap ŸÑŸÑŸÄ grid ŸÅŸÇÿ∑ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Main CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
  <header class="app-navbar">
    <div class="container d-flex align-items-center justify-content-between gap-3">
      <div class="app-brand">
        <div class="brand-logo">‚ñ∂</div>
        <div>
          <div class="brand-text-main">
            <span>Media Server</span>
          </div>
          <div class="brand-sub text-truncate">
            {{ base_dir }}
          </div>
        </div>
      </div>

      <div class="app-navbar-right">
        {% if pw_enabled %}
          <div class="chip chip--success">
            <span class="chip-dot"></span>
            <span>Auth enabled</span>
          </div>
        {% else %}
          <div class="chip chip--warning">
            <span class="chip-dot"></span>
            <span>Public access</span>
          </div>
        {% endif %}

        <button id="theme-toggle" class="theme-toggle" type="button" aria-label="Toggle dark / light mode">
          <span class="theme-toggle-icon" data-theme-icon>üåô</span>
          <span data-theme-label>Dark</span>
          <span class="theme-toggle-knob"></span>
        </button>
      </div>
    </div>
  </header>

  <main class="app-main">
    <div class="container">

      <!-- Breadcrumb -->
      <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb m-0">
          <li class="breadcrumb-item">
            <a href="{{ url_for('index') }}">Home</a>
          </li>
          {% for crumb in breadcrumbs %}
            <li class="breadcrumb-item {% if loop.last %}active{% endif %}" {% if loop.last %}aria-current="page"{% endif %}>
              {% if not loop.last %}
                <a href="{{ url_for('index', p=crumb.path) }}">{{ crumb.name }}</a>
              {% else %}
                {{ crumb.name }}
              {% endif %}
            </li>
          {% endfor %}
        </ol>
      </nav>

      <!-- Top surface: filters + upload -->
      <section class="surface mb-4">
        <div class="row g-4">
          <!-- Filters -->
          <div class="col-12 col-lg-8">
            <div class="d-flex justify-content-between align-items-center mb-3 gap-3">
              <div class="surface-header-label">Browse & Filter</div>
              <div class="stat-badges">
                <div class="stat-pill">
                  <span>Items</span><strong>{{ total_items }}</strong>
                </div>
                <div class="stat-pill">
                  <span>Visible size</span><strong>{{ total_size_human }}</strong>
                </div>
              </div>
            </div>

            <form method="get" class="row g-2 align-items-center">
              <input type="hidden" name="p" value="{{ current_rel }}">
              <div class="col-12 col-md-4">
                <input
                  type="text"
                  name="q"
                  value="{{ q or '' }}"
                  class="form-control"
                  placeholder="Search files..."
                  autocomplete="off"
                >
              </div>
              <div class="col-6 col-md-2">
                <select name="type" class="form-select">
                  <option value="all" {% if file_type=='all' %}selected{% endif %}>All Types</option>
                  <option value="video" {% if file_type=='video' %}selected{% endif %}>Video</option>
                  <option value="image" {% if file_type=='image' %}selected{% endif %}>Image</option>
                  <option value="audio" {% if file_type=='audio' %}selected{% endif %}>Audio</option>
                  <option value="other" {% if file_type=='other' %}selected{% endif %}>Other</option>
                </select>
              </div>
              <div class="col-6 col-md-2">
                <select name="sort" class="form-select">
                  <option value="name" {% if sort_by=='name' %}selected{% endif %}>Name</option>
                  <option value="size" {% if sort_by=='size' %}selected{% endif %}>Size</option>
                  <option value="mtime" {% if sort_by=='mtime' %}selected{% endif %}>Date</option>
                </select>
              </div>
              <div class="col-6 col-md-2">
                <select name="order" class="form-select">
                  <option value="asc" {% if order=='asc' %}selected{% endif %}>Asc</option>
                  <option value="desc" {% if order=='desc' %}selected{% endif %}>Desc</option>
                </select>
              </div>
              <div class="col-6 col-md-2">
                <button class="btn-solid" type="submit">
                  <span>Apply</span>
                </button>
              </div>
            </form>
          </div>

          <!-- Upload -->
          <div class="col-12 col-lg-4">
            <div class="surface surface--sub h-100 d-flex flex-column justify-content-between">
              <div class="mb-2 d-flex justify-content-between align-items-center">
                <span class="surface-header-label">Upload</span>
                <span class="text-xs text-muted">Requires owner approval</span>
              </div>
              <form method="post" action="{{ url_for('upload') }}" enctype="multipart/form-data" class="row g-2">
                <input type="hidden" name="p" value="{{ current_rel }}">
                <div class="col-12">
                  <input type="file" name="files" multiple class="form-control">
                </div>
                <div class="col-12">
                  <button class="btn-ghost" type="submit">
                    <span>Upload for approval</span>
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Pending section (admin only) -->
        {% if is_admin and pending_files %}
        <div class="pending-section">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <div class="text-sm" style="color: var(--warning); font-weight: 500;">
              ‚ö† Pending approvals ({{ pending_count }})
            </div>
          </div>
          <div class="row g-2">
            {% for p in pending_files %}
              <div class="col-12 col-md-6 col-xl-4">
                <div class="pending-card">
                  <div class="flex-grow-1 me-1">
                    <div class="pending-name text-truncate">{{ p.relpath }}</div>
                    <div class="pending-meta">{{ p.size_human }} ‚Ä¢ {{ p.mtime_str }}</div>
                  </div>
                  <div class="pending-actions">
                    <form method="post" action="{{ url_for('approve_file', filename=p.relpath) }}">
                      <button type="submit" class="btn-approve" title="Approve">‚úì</button>
                    </form>
                    <form method="post" action="{{ url_for('reject_file', filename=p.relpath) }}" onsubmit="return confirm('Reject this file?');">
                      <button type="submit" class="btn-reject" title="Reject">‚úï</button>
                    </form>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}
      </section>

      <!-- Content grid -->
      <section class="mb-5">
        <div class="row g-3">
          <!-- Folders -->
          {% for d in folders %}
            <div class="col-12 col-sm-6 col-lg-4 col-xl-3">
              <a href="{{ url_for('index', p=d.relpath) }}" class="file-folder">
                <div class="file-icon">üìÅ</div>
                <div class="flex-grow-1 overflow-hidden">
                  <div class="file-folder-name">{{ d.name }}</div>
                  <div class="file-folder-meta">{{ d.items_count }} items</div>
                </div>
              </a>
            </div>
          {% endfor %}

          <!-- Files -->
          {% for f in files %}
            <div class="col-12 col-sm-6 col-lg-4 col-xl-3">
              <article class="file-card">
                <header class="file-card-header">
                  <div class="file-icon">
                    {% if f.is_video %}üé¨{% elif f.is_image %}üñºÔ∏è{% elif f.is_audio %}üéµ{% else %}üìÑ{% endif %}
                  </div>
                  <span class="badge-type">{{ f.ext or "file" }}</span>
                </header>
                <div>
                  <div class="file-name" title="{{ f.name }}">{{ f.name }}</div>
                  <div class="file-meta">
                    {{ f.size_human }} ‚Ä¢ {{ f.mtime_str }}
                  </div>
                </div>
                <div class="file-actions">
                  {% if f.is_video %}
                    <a href="{{ url_for('stream_page', filename=f.relpath) }}" class="btn-solid">Play</a>
                  {% elif f.is_image %}
                    <a href="{{ url_for('download_file', filename=f.relpath) }}" target="_blank" class="btn-solid">View</a>
                  {% else %}
                    <a href="{{ url_for('download_file', filename=f.relpath) }}" download class="btn-ghost">Download</a>
                  {% endif %}

                  {% if is_admin %}
                    <form method="post" action="{{ url_for('delete_file', filename=f.relpath, p=current_rel) }}" onsubmit="return confirm('Delete {{ f.name }}?');">
                      <button type="submit" class="btn-danger-outline" title="Delete">
                        üóë
                      </button>
                    </form>
                  {% endif %}
                </div>
              </article>
            </div>
          {% endfor %}

          {% if not folders and not files %}
            <div class="col-12">
              <div class="surface surface--sub empty-state">
                <div class="empty-icon">üìÇ</div>
                <p class="mt-3 mb-1">This folder is empty</p>
                <p class="text-xs text-muted mb-0">Upload files to get started.</p>
              </div>
            </div>
          {% endif %}
        </div>
      </section>
    </div>
  </main>

  <!-- Theme JS -->
  <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
</body>
</html>
