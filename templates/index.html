<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8">
  <title>Media Server</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>

  <!-- ========== HEADER ========== -->
  <header class="top-header">
    <div class="header-container">
      <div class="branding">
        <div class="logo-icon">â–¶</div>
        <div class="logo-text">
          <h1>Media Server</h1>
          <p>{{ base_dir }}</p>
        </div>
      </div>
      
      <div class="header-right">
        {% if pw_enabled %}
          <span class="status-badge status-secure">ğŸ”’ Secured</span>
        {% else %}
          <span class="status-badge status-public">ğŸŒ Public</span>
        {% endif %}
        
        <button class="theme-switcher" id="theme-toggle">
          <span data-theme-icon>ğŸŒ™</span>
          <span data-theme-label>Dark</span>
        </button>
      </div>
    </div>
  </header>

  <!-- ========== MAIN CONTENT ========== -->
  <div class="page-wrapper">
    <div class="content-container">

      <!-- Breadcrumb -->
      <nav class="breadcrumb-nav">
        <a href="{{ url_for('index') }}" class="crumb">ğŸ  Home</a>
        {% for crumb in breadcrumbs %}
          <span class="crumb-divider">â€º</span>
          {% if loop.last %}
            <span class="crumb crumb-active">{{ crumb.name }}</span>
          {% else %}
            <a href="{{ url_for('index', p=crumb.path) }}" class="crumb">{{ crumb.name }}</a>
          {% endif %}
        {% endfor %}
      </nav>

      <!-- Quick Stats -->
      <div class="quick-stats">
        <div class="stat-box">
          <div class="stat-icon">ğŸ“Š</div>
          <div class="stat-info">
            <div class="stat-value">{{ total_items }}</div>
            <div class="stat-label">Items</div>
          </div>
        </div>
        <div class="stat-box">
          <div class="stat-icon">ğŸ’¾</div>
          <div class="stat-info">
            <div class="stat-value">{{ total_size_human }}</div>
            <div class="stat-label">Total Size</div>
          </div>
        </div>
      </div>

      <!-- Filters & Upload Grid -->
      <div class="controls-wrapper">
        
        <!-- FILTERS CARD -->
        <div class="control-card">
          <div class="card-top">
            <h2>ğŸ” Browse & Filter</h2>
          </div>
          <form method="get" class="filter-form">
            <input type="hidden" name="p" value="{{ current_rel }}">
            
            <input 
              type="text" 
              name="q" 
              value="{{ q or '' }}" 
              class="search-input" 
              placeholder="Search files..."
            >
            
            <div class="filter-row">
              <select name="type" class="filter-select">
                <option value="all" {% if file_type=='all' %}selected{% endif %}>All Types</option>
                <option value="video" {% if file_type=='video' %}selected{% endif %}>ğŸ¬ Videos</option>
                <option value="image" {% if file_type=='image' %}selected{% endif %}>ğŸ–¼ï¸ Images</option>
                <option value="audio" {% if file_type=='audio' %}selected{% endif %}>ğŸµ Audio</option>
                <option value="other" {% if file_type=='other' %}selected{% endif %}>ğŸ“„ Other</option>
              </select>
              
              <select name="sort" class="filter-select">
                <option value="name" {% if sort_by=='name' %}selected{% endif %}>Name</option>
                <option value="size" {% if sort_by=='size' %}selected{% endif %}>Size</option>
                <option value="mtime" {% if sort_by=='mtime' %}selected{% endif %}>Date</option>
              </select>
              
              <select name="order" class="filter-select">
                <option value="asc" {% if order=='asc' %}selected{% endif %}>â†‘ Asc</option>
                <option value="desc" {% if order=='desc' %}selected{% endif %}>â†“ Desc</option>
              </select>
              
              <button type="submit" class="apply-btn">Apply</button>
            </div>
          </form>
        </div>

        <!-- UPLOAD CARD -->
        <div class="control-card">
          <div class="card-top">
            <h2>â¬†ï¸ Upload Files</h2>
            <span class="help-text">Requires approval</span>
          </div>
          <form method="post" action="{{ url_for('upload') }}" enctype="multipart/form-data" class="upload-form">
            <input type="hidden" name="p" value="{{ current_rel }}">
            <input type="file" name="files" multiple id="file-up" class="file-input">
            <label for="file-up" class="file-picker">
              ğŸ“ Choose Files
            </label>
            <button type="submit" class="upload-btn">Upload</button>
          </form>
        </div>
        
      </div>

      <!-- PENDING APPROVALS (Admin Only) -->
      {% if is_admin and pending_files %}
      <div class="control-card warning-card">
        <div class="card-top">
          <h2>âš ï¸ Pending Approvals</h2>
          <span class="count-badge">{{ pending_count }}</span>
        </div>
        <div class="pending-items">
          {% for p in pending_files %}
            <div class="pending-row">
              <div class="pending-details">
                <div class="pending-file">{{ p.relpath }}</div>
                <div class="pending-info">{{ p.size_human }} â€¢ {{ p.mtime_str }}</div>
              </div>
              <div class="pending-btns">
                <form method="post" action="{{ url_for('approve_file', filename=p.relpath) }}" style="display:inline">
                  <button class="action-btn approve-btn">âœ“</button>
                </form>
                <form method="post" action="{{ url_for('reject_file', filename=p.relpath) }}" onsubmit="return confirm('Reject?')" style="display:inline">
                  <button class="action-btn reject-btn">âœ•</button>
                </form>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- MEDIA LIBRARY -->
      {% if folders or files %}
        <div class="library-grid">
          
          <!-- FOLDERS -->
          {% for d in folders %}
            <a href="{{ url_for('index', p=d.relpath) }}" class="media-card folder-card">
              <div class="card-icon">ğŸ“</div>
              <div class="card-body">
                <h3 class="card-title">{{ d.name }}</h3>
                <p class="card-subtitle">{{ d.items_count }} items</p>
              </div>
            </a>
          {% endfor %}

          <!-- FILES -->
          {% for f in files %}
            <div class="media-card file-card">
              <div class="card-header">
                <div class="file-icon">
                  {% if f.is_video %}ğŸ¬
                  {% elif f.is_image %}ğŸ–¼ï¸
                  {% elif f.is_audio %}ğŸµ
                  {% else %}ğŸ“„{% endif %}
                </div>
                <span class="file-type">{{ f.ext or "file" }}</span>
              </div>
              <div class="card-body">
                <h3 class="card-title" title="{{ f.name }}">{{ f.name }}</h3>
                <p class="card-subtitle">{{ f.size_human }} â€¢ {{ f.mtime_str }}</p>
              </div>
              <div class="card-actions">
                {% if f.is_video %}
                  <a href="{{ url_for('stream_page', filename=f.relpath) }}" class="primary-action">â–¶ Play</a>
                {% elif f.is_image %}
                  <a href="{{ url_for('download_file', filename=f.relpath) }}" target="_blank" class="primary-action">ğŸ‘ View</a>
                {% else %}
                  <a href="{{ url_for('download_file', filename=f.relpath) }}" download class="secondary-action">â¬‡ Download</a>
                {% endif %}
                
                {% if is_admin %}
                  <form method="post" action="{{ url_for('delete_file', filename=f.relpath, p=current_rel) }}" onsubmit="return confirm('Delete?')" style="display:inline">
                    <button class="icon-action delete-action">ğŸ—‘</button>
                  </form>
                {% endif %}
              </div>
            </div>
          {% endfor %}

        </div>
      {% else %}
        <!-- EMPTY STATE -->
        <div class="empty-box">
          <div class="empty-icon">ğŸ“‚</div>
          <h3 class="empty-heading">This folder is empty</h3>
          <p class="empty-subtext">Upload files to get started</p>
        </div>
      {% endif %}

    </div>
  </div>

  <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
  <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
